set -g @plugin 'nikolovlazar/tokyo-night-tmux'
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'aserowy/tmux.nvim'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin "loichyan/tmux-toggle-popup"

set -g @sessionx-bind 's'

# Setup tmux theme
set -g @tokyo-night-tmux_window_id_style fsquare
set -g @tokyo-night-tmux_pane_id_style hsquare
set -g @tokyo-night-tmux_zoom_id_style dsquare

set-option -g status-position bottom


set-option -sa terminal-features ',ghostty:RGB' # Makes sure that colors in tmux are the same as without tmux
# Undercurl
# set -g default-terminal "${TERM}"
set -as terminal-features ",*:RGB"
set -g default-terminal "ghostty" # If you don't add this, then neovim :checkhealth will complain. But "alacritty" also works

# Allow rendering of images in tmux
set -gq allow-passthrough on
set -g visual-activity off

# Toggle tmux status bar
bind '\' set status
if-shell "[[ $(tmux lsw | wc -l) -le 1 ]]" 'set -g status'

set -g status on

# Enable mouse
set -g mouse on

# Increase history limit
set -g history-limit 30000

# Start windows and panes at 1 and not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Zero-out escape time delay for quicker response
set -sg escape-time 0

# keybindings
bind-key r source-file ~/.config/tmux/tmux.conf \; display-message "~/.config/tmux/tmux.conf reloaded"

# resizing
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind -n M-r source-file ~/.config/tmux/tmux.conf \; display-message "~/.config/tmux/tmux.conf reloaded"
bind -n M-b split-window -h -c "#{pane_current_path}"
bind -n M-v split-window -v -c "#{pane_current_path}"
bind -n M-Left previous-window
bind -n M-Right next-window
bind -n M-c new-window
bind -n M-x killp
bind -n M-z resize-pane -Z
bind -n M-n command-prompt -I "#W" "rename-window '%%'"
bind -n HOME swap-window -t -1 \; select-window -t -1
bind -n END swap-window -t +1 \; select-window -t +1

bind -n M-t run "#{@popup-toggle} -Ed'#{pane_current_path}' -w75% -h75%"

# Start tmux fingers by pressing Alt+F
# bind -n M-f run -b "#{@fingers-cli} start #{pane_id}"

# Set Alt-1 to Alt-9 to switch to or create windows 1-9
# bind-key -n M-1 if-shell 'tmux select-window -t :1' '' 'new-window -t :1'
# bind-key -n M-2 if-shell 'tmux select-window -t :2' '' 'new-window -t :2'
# bind-key -n M-3 if-shell 'tmux select-window -t :3' '' 'new-window -t :3'
# bind-key -n M-4 if-shell 'tmux select-window -t :4' '' 'new-window -t :4'
# bind-key -n M-5 if-shell 'tmux select-window -t :5' '' 'new-window -t :5'
# bind-key -n M-6 if-shell 'tmux select-window -t :6' '' 'new-window -t :6'
# bind-key -n M-7 if-shell 'tmux select-window -t :7' '' 'new-window -t :7'
# bind-key -n M-8 if-shell 'tmux select-window -t :8' '' 'new-window -t :8'
# bind-key -n M-9 if-shell 'tmux select-window -t :9' '' 'new-window -t :9'

# Open the new panes in the current path
bind v split-window -v -c "#{pane_current_path}"
bind h split-window -h -c "#{pane_current_path}"

setw -g automatic-rename on
setw -g automatic-rename-format "#{b:pane_current_path}"

# vim tpipeline settings
set -g focus-events on
set -g status-style bg=default
set -g status-left '#(cat #{socket_path}-\#{session_id}-vimbridge)'
set -g status-left-length 90
set -g status-right '#(cat #{socket_path}-\#{session_id}-vimbridge-R)'
set -g status-right-length 90
set -g status-justify absolute-centre



# If this is your first time using tmux, you will need to press (Ctrl + Space) + I to fetch the plugins.
run '~/.tmux/plugins/tpm/tpm'
